### 1. Описание продукта

Локальный MCP-сервер CodeGraph, который:

* строит граф кода (entities + relationships) и векторный индекс;
* даёт LLM доступ к этим данным через инструменты MCP;
* отвечает на вопросы по коду/архитектуре и помогает с рефакторингом/тестами и аналитикой.

**Цель 1.0.0:** MVP, который полностью покрывает цикл: индексация кода -> граф -> Q&A через MCP. А также работает лучше claude-code MCP.

### 2. Scope MVP 1.0.0

**Core-фичи:**

1. Локальный MCP-сервер CodeGraph

    * Набор инструментов: индексация, просмотр графа, семантический поиск, анализ влияния изменений, поиск дубликатов.

2. Единая база знаний в SQLite-vec

    * Векторное хранения данных для быстрого поиска и нахождения связей. 

3. Многоагентная индексация

    * Tree-sitter: сбор кода, построение графа, эмбеддинги.

4. Q&A-ассистент

    * Отвечает на вопросы двух типов:

        * Поиск/понимание кода (объяснение, API, поиск по описанию, влияние изменений).
        * Генерация/модификация кода (рефакторинг, дописывание метода, фикс бага, тесты).

**Полировка:**

* Единый JSON-формат ответов инструментов (id, status, summary, ссылки на сущности/файлы).
* Структурированное логирование (кто что вызвал, сколько заняло, сколько сущностей найдено).

**Не входит в 1.0.0:**

* Веб-UI.
* Расширенный набор языков.
* Оптимизация эмбеддингов.

### 3. Стратегия деплоя

**Стратегия: Recreate Deployment.**

* Остановить текущий экземпляр MCP-сервера.
* Задеплоить версию с тегом.
* Мигрировать базу при необходимости.
* Запустить сервис.
* Проверить health-check + базовые сценарии.

Причина: пока локальное использование, важна простота и предсказуемость, а не сложные схемы.

### 4. Таймлайн релиза

**1-30 сентября 2025 - исследование и прототипирование**

* Уточнение требований и сценариев работы.
* Подбор и подготовка тестового корпуса вопросов и кодовой базы.
* Прототип графа кода + векторного поиска, первые эксперименты с LLM и MCP-инструментами.

**1-31 октября 2025 - начало разработки**

* Реализация MCP-сервера с основным набором инструментов (поиск по regexp).
* Базовые автотесты.

**1-30 ноября 2025 - разработка**

* Реализация основных инструментов: граф, семантический поиск, степень влияния, дубликаты.
* Встраивание многоагентной индексации (Tree-sitter, граф, эмбеддинги).

**1-20 декабря 2025 - доработки и тестирование**

* Оптимизация производительности индексации и запросов.
* Сравнение решения с baseline (claude-code mcp).
* Написание документации.

**21-31 декабря 2025 - релиз и сопровождение**

* Релиз версии 1.0.0.
* Мониторинг ошибок, сбор отзывов использования.
* Фиксация идей и задач на будущие релизы.

### 5. Release Notes v1.0.0

**CodeGraph MCP - v1.0.0 (25.12.2025)**

**Новое:**
- Локальный MCP-сервер CodeGraph для Q&A по кодовой базе.
- Граф кода в SQLite (entities + relationships).
- Семантический поиск на sqlite-vec.
- Многоагентная индексация с Tree-sitter.

**Улучшения:**
- Стандартизированный JSON-ответ MCP-инструментов.
- Структурированное логирование запросов и ошибок.
- Улучшенная скорость индексации.

**Известные ограничения:**
- Фокус на JS/TS.
- Нет веб-интерфейса, работа только через сторонний LLM-клиент.

### 6. Список проверок

Считаем релиз 1.0.0 успешным, если выполнены все пункты:

1. **Индексация кода**
   Репозиторий дизайн-системы полностью проиндексирован без ошибок.

2. **Корректность графа кода**
   Выборочно проверено несколько модулей: сущности в базе совпадают с реальным кодом.

3. **Семантический поиск**
   Несколько эталонных запросов возвращают ожидаемые файлы/функции.

4. **Q&A-сценарии по коду**
   Для набора тестовых вопросов ассистент решает задачи:
   - объяснение реализации;
   - описание публичного API.

5. **Сравнение с baseline**
   На созданном корпусе вопросов качество ответов лучше baseline.

6. **Интеграция с LLM-клиентом**
   MCP-сервер стабильно подключается к клиенту, инструменты видны и успешно вызываются.

7. **Логи и мониторинг**
   - В логах нет повторяющихся критических ошибок; 
   - Есть записи по вызовам инструментов, времени ответа и возможным сбоям.


### 7. План отката

**Триггеры отката:**

* массовые ошибки индексации или построения графа;
* ключевые MCP-инструменты возвращают ошибки или бессмысленные ответы;
* качество ответов по тестовому корпусу проседает относительно предыдущей версии.

**Шаги отката:**

1. Зафиксировать инцидент (создать задачу + сохранить логи и копию бд).
2. Остановить MCP-сервер.
3. Переключиться на предыдущий стабильный тег в git и соответствующую версию бд.
4. Запустить сервер.
5. Задокументировать причину отката и артефакты.

**Ответственность:**

* **QA Lead** - фиксирует проблему, предлагает откат, проверяет систему после отката.
* **Tech Lead** - выполняет технические шаги отката и даёт первичный анализ причин.
* **ПМ** - утверждает решение об откате и информирует заинтересованные стороны.

### 8. Риски и Меры по их снижению

**Риск 1: Некачественный граф**

* *Проблема:* неверные связи в графе -> LLM делает неверные выводы.
* *Меры:*
    * выборочная ручная проверка графа по важным модулям;
    * автотесты на построение графа.

**Риск 2: Перегрузка или утечки памяти при индексации**

* *Проблема:* при больших репозиториях сервер тормозит или падает.
* *Меры:*

    * профилировать индексацию;
    * ограничивать размер батчей и параллелизма;

**Риск 3: Повреждение БД**

* *Проблема:* потеря или порча файла базы знаний делает ассистента бесполезным.
* *Меры:*

    * регулярные бэкапы;
    * возможность полного реиндекса;
    * проверка целостности файла перед запуском сервера.

**Риск 4: Уверенные, но неправильные ответы LLM**

* *Проблема:* ассистент говорит уверенно, но опирается на некорректный контекст.
* *Меры:*

    * делать акцент на структурированные ответы MCP-инструментов;
    * расширять покрытие тестами и автоматически ловить галлюцинации.

**Риск 5: Ошибки процесса релиза/отката (человеческий фактор)**

* *Проблема:* неправильный порядок действий при релизе.
* *Меры:*

    * использовать короткие чек-листы;
    * автоматизация процесса.
