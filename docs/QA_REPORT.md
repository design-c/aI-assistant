# Отчёт по тестированию и качеству

## 1. Цели и контекст

Описать как был организован процесс тестирования MCP-сервера.

Проект в данном репозитории представляет сильно упрощенную копию итогового решения, созданного в приватном Gitlab Artsofte.

## 2. Роли и организация работы

Роли в команде, для решения задания:
- Дорохов С. - **QA Team Lead** и **developer**
- Батуев М. -  **Project Manager** и **QA Engineer**

Ответственности ролей:
- **QA Team Lead**
    - Ответственный за тестовую стратегию и анализ результатов тестирования.

- **Developers**
    - Разрабатывали функциональность MCP-сервера и писали юнит тесты.

- **QA Engineers**
    - Разрабатывали функциональные тесты и выполняли ручное тестирование через.

- **Project Manager**
    - Использует отчёт для оценки готовности к релизу.

## 3. Реализованная тестовая стратегия

Основные элементы стратегии описаны в документе [TESTING.md](../TESTING.md):

- Выделены виды тестов:
    - unit-тесты разработчиков;
    - функциональные контрактные тесты QA;
    - ручное функциональное тестирование через клиент.
- Настроен запуск автотестов в GitHub Actions при `push` и `pull_request` в ветки `develop` и `main`.
- Без успешного прохождения автотестов и одобрения QA Team Lead, изменения не мёржатся в `main`.

## 4. Автоматизированные тесты

### 4.1. Developer-тесты

Расположение: `tests/dev/*`.  
Запуск: `npm run test:dev`.

Сценарии:

1. **Проверка корректного формирования stub-ответа**
    - Вызов `createStubResult('index', { directory: '/repo', fullScan: true })`.
    - Проверяется:
        - содержимое `structuredContent` (имя инструмента, флаг `stub`, текстовое сообщение, аргументы);
        - согласованность текстового представления (`content[0].text`) и структуры (`structuredContent`).

2. **Проверка соответствия Zod-схеме**
    - Вызов `createStubResult('semantic_search', { query: 'find controllers', limit: 5 })`.
    - Результат валидируется схемой Zod, определённой в `stubOutputSchema`.

### 4.2. QA-тесты

Расположение: `tests/qa/*`.  
Запуск: `npm run test:qa`.

Сценарии:
- Для каждого зарегистрированного инструмента (`index`, `clean_index`, `get_graph`, `get_graph_stats`, `get_graph_health`, `list_file_entities`, `list_entity_relationships`, `semantic_search`, `query`, `analyze_code_impact`, `detect_code_clones`) выполняется проверка:

    - `structuredContent.tool` совпадает с именем инструмента.
    - `structuredContent.stub` имеет значение `true`.
    - `structuredContent.message` содержит строку об успешном выполнении.
    - `structuredContent.receivedArgs` в точности совпадает с переданными аргументами.


### 4.3. Результаты прогона автотестов

- Все developer-тесты проходят успешно.
- Все QA-тесты проходят успешно.
- В GitHub Actions оба шага (`npm run test:dev` и `npm run test:qa`) завершаются без ошибок.

## 5. Ручное тестирование

Ручное тестирование проводилось через совместимый MCP-клиент (LM Studio).

Проверенные сценарии:

1. **Обнаружение и регистрация инструментов**
    - Клиент корректно видит MCP-сервер и список его инструментов.
    - Названия инструментов в клиенте совпадают с теми, что задокументированы в коде и тестах.

2. **Вызовы базовых инструментов**
    - Вызов `index` с параметрами директории.
    - Вызов `get_graph` с ограничением `limit`.
    - Вызов `semantic_search` с текстовым запросом.

3. **Проверка формата ответов**
    - Ответы содержат поля `tool`, `stub`, `message`, `receivedArgs`.
    - Значения этих полей согласованы с результатами автотестов.

По результатам ручного тестирования проблем не обнаружено.

## 6. Метрики качества

На текущем этапе используются следующие метрики:

- **Состояние CI**
    - Все запуски workflow для актуального состояния кода завершаются успешно.
    - Ошибки в тестах рассматриваются как блокирующие для слияния Pull Request в `main`.

- **Покрытие ключевой логики тестами**
    - Функция `createStubResult`, используемая всеми инструментами, покрыта unit-тестами.
    - Для всех зарегистрированных MCP-инструментов существуют QA-тесты, проверяющие единый контракт ответа.

- **Дефекты**
    - В рамках текущего объёма функциональности дефектов нет.
    - Все выявленные замечания на этапе настройки окружения и CI были устранены в процессе работы.

## 7. Выводы и рекомендации

### 7.1. Выводы

- Описан рабочий цикл управления качеством:
    - определены роли и ответственность;
    - задокументирована тестовая стратегия;
    - настроен GitHub Actions автоматически запускающий тесты при изменениях;
    - качество считается на ветке `main`.

- Набор автотестов соответствует упрощенной копии проекта:
    - unit-тесты покрывают ключевую вспомогательную функцию;
    - функциональные тесты распространяются на все инструменты MCP.

- Процесс ручного тестирования дополняет автоматизацию и подтверждает корректность интеграции с клиентом.

### 7.2. Развитие

При дальнейшем развитии проекта имеет смысл:

1. Добавить интеграционные тесты:
    - поднятие MCP-сервера в тестовом окружении;

2. Расширить автотесты при появлении реальной логики:
    - тесты построения графа кода;
    - тесты поиска по эмбеддингам и работе с базой данных.

Для решения задания, в текущий репозиторий перенесена частичная сигнатура MCP-сервера из приватного репозиторий Artsofte.
Для перенесенного функционала написаны qa и develop тесты, а также проведено ручное тестирование.
